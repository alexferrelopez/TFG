# EV Routing Platform

This repository contains an end-to-end stack for electric vehicle (EV) routing. It bundles the data-processing scripts that generate charger datasets, the routing API that builds EV-feasible trips, the docker infrastructure holding the core services, and the web client used to explore the results on top of custom vector map tiles.

## Prerequisites

- **Node.js 22+** (for `ev_router` and `demo_node_2`).
- **npm** (included with Node).
- **Docker Desktop**  to run Martin, OpenRouteService, Photon, and helper containers.

## Quick start

1. **Install dependencies**  
   - `cd ev_router && npm install`  
   - `cd demo_node_2 && npm install`
2. **Download data zip and extract it (leaving the 3 folders in the root directory): https://drive.google.com/file/d/1JBOH0dkTKnDSvCRJFVComN-JDoNL1FPR/view?usp=sharing**
3. **With Docker Desktop installed in a Windows: run start-dev.bat (this will take a while the first time since some images have to be built)** 
4. Browse to the Vite dev server (default `http://localhost:5173`). Adjust the hard-coded IPs if you are not running everything on the same machine.

## Highlights

- Full pipeline from DATEX II charger feeds to ready-to-serve GeoJSON and vector tiles.
- Modular routing service that prunes candidate chargers, evaluates feasibility, and assembles legs through OpenRouteService.
- MapLibre-powered SPA with charger discovery, percentile filters, and EV-specific route planning UX.
- Docker setup for the supporting infrastructure (Martin tile server, OpenRouteService, Photon).

## Repository layout

| Path | Purpose |
| --- | --- |
| `demo_node_2/` | Vite + Vue 3 single-page app that visualises chargers, filters them, and calls the EV routing API. |
| `ev_router/` | Express-based API that exposes `/ev-route`, `/geocode`, `/reverse`, and health endpoints. |
| `docker_files/` | Configuration, styles, and helper scripts for the Martin tile server and charger tiles. |
| `docker_images/` | Docker build contexts for custom images (Photon, MBTiles tooling). |
| `licenses/` | Third-party license texts bundled with the project. |
| `ors/` | Configuration and files for OpenRouteService. |
| `photon_data/` | Configuration and files for Photon. |


## Core services

### Vector tiles and sprites

The Martin container defined in `docker-compose.yml` serves:

- Base map vector tiles (`docker_files/mbtiles/**`).
- Charger tiles and spritemaps generated by `docker_files/make_charger_tiles.bash`.
- Shared style and sprite definitions referenced by the SPA.

### Photon geocoder

Photon runs from the custom image in `docker_images/photon/`. The SPA and API rely on it for:

- Forward geocoding (`/geocode` endpoint on `ev_router`).
- Reverse geocoding (`/reverse` endpoint on `ev_router`).

### `ev_router`

The routing API (Node.js) performs several stages for each request:

1. Fetch baseline directions via OpenRouteService (ORS).
2. Prune charger candidates along the corridor (`prune.js`).
3. Build a time-weighted graph that respects EV range and charging power limits (`solver.js`).
4. Run Dijkstra to find a feasible chain of stops.
5. Stitch ORS legs and compute trip summaries (`stitch.js`).

### `demo_node_2`

The browser (and Capacitor) client:

- Renders the Martin style with MapLibre.
- Displays charger percentile filters and popups.
- Integrates Photon search.
- Calls the routing API and renders the resulting path, stops, and route statistics.